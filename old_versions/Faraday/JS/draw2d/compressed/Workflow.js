/**
This notice must be untouched at all times.
This is the COMPRESSED version of Draw2D
WebSite: http://www.draw2d.org
Copyright: 2006 Andreas Herz. All rights reserved.
Created: 5.11.2006 by Andreas Herz (Web: http://www.freegroup.de )
LICENSE: LGPL
**/

draw2d.Workflow=function(id){try{if(!id){return;}this.isIPad=navigator.userAgent.match(/iPad/i)!=null;this.menu=null;this.gridWidthX=10;this.gridWidthY=10;this.snapToGridHelper=null;this.verticalSnapToHelperLine=null;this.horizontalSnapToHelperLine=null;this.snapToGeometryHelper=null;this.figures=new draw2d.ArrayList();this.lines=new draw2d.ArrayList();this.commonPorts=new draw2d.ArrayList();this.dropTargets=new draw2d.ArrayList();this.compartments=new draw2d.ArrayList();this.selectionListeners=new draw2d.ArrayList();this.dialogs=new draw2d.ArrayList();this.toolPalette=null;this.dragging=false;this.tooltip=null;this.draggingLine=null;this.draggingLineCommand=null;this.commandStack=new draw2d.CommandStack();this.oldScrollPosLeft=0;this.oldScrollPosTop=0;this.currentSelection=null;this.currentMenu=null;this.connectionLine=new draw2d.Line();this.resizeHandleStart=new draw2d.LineStartResizeHandle(this);this.resizeHandleEnd=new draw2d.LineEndResizeHandle(this);this.resizeHandle1=new draw2d.ResizeHandle(this,1);this.resizeHandle2=new draw2d.ResizeHandle(this,2);this.resizeHandle3=new draw2d.ResizeHandle(this,3);this.resizeHandle4=new draw2d.ResizeHandle(this,4);this.resizeHandle5=new draw2d.ResizeHandle(this,5);this.resizeHandle6=new draw2d.ResizeHandle(this,6);this.resizeHandle7=new draw2d.ResizeHandle(this,7);this.resizeHandle8=new draw2d.ResizeHandle(this,8);this.resizeHandleHalfWidth=parseInt(this.resizeHandle2.getWidth()/2);draw2d.Canvas.call(this,id);this.setPanning(this.isIPad);if(this.html!==null){this.html.style.backgroundImage="url(grid_10.png)";this.html.className="Workflow";oThis=this;this.html.tabIndex="0";var _1348=function(){var _1349=arguments[0]||window.event;_1349.cancelBubble=true;_1349.returnValue=false;_1349.stopped=true;var diffX=_1349.clientX;var diffY=_1349.clientY;var _134c=oThis.getScrollLeft();var _134d=oThis.getScrollTop();var _134e=oThis.getAbsoluteX();var _134f=oThis.getAbsoluteY();var line=oThis.getBestLine(diffX+_134c-_134e,diffY+_134d-_134f,null);if(line!==null){line.onContextMenu(diffX+_134c-_134e,diffY+_134d-_134f);}else{oThis.onContextMenu(diffX+_134c-_134e,diffY+_134d-_134f);}};this.html.oncontextmenu=function(){return false;};var oThis=this;var _1352=function(event){var ctrl=event.ctrlKey;oThis.onKeyDown(event.keyCode,ctrl);};var _1355=function(){var _1356=arguments[0]||window.event;if(_1356.returnValue==false){return;}var diffX=_1356.clientX;var diffY=_1356.clientY;var _1359=oThis.getScrollLeft();var _135a=oThis.getScrollTop();var _135b=oThis.getAbsoluteX();var _135c=oThis.getAbsoluteY();oThis.onMouseDown(diffX+_1359-_135b,diffY+_135a-_135c);};var _135d=function(e){var _135f=e.touches.item(0);var diffX=_135f.clientX;var diffY=_135f.clientY;var _1362=oThis.getScrollLeft();var _1363=oThis.getScrollTop();var _1364=oThis.getAbsoluteX();var _1365=oThis.getAbsoluteY();oThis.onMouseDown(diffX+_1362-_1364,diffY+_1363-_1365);e.preventDefault();};var _1366=function(){var _1367=arguments[0]||window.event;if(oThis.currentMenu!==null){oThis.removeFigure(oThis.currentMenu);oThis.currentMenu=null;}if(_1367.button==2){return;}var diffX=_1367.clientX;var diffY=_1367.clientY;var _136a=oThis.getScrollLeft();var _136b=oThis.getScrollTop();var _136c=oThis.getAbsoluteX();var _136d=oThis.getAbsoluteY();oThis.onMouseUp(diffX+_136a-_136c,diffY+_136b-_136d);};var _136e=function(e){var _1370=e.touches.item(0);var diffX=_1370.clientX;var diffY=_1370.clientY;var _1373=oThis.getScrollLeft();var _1374=oThis.getScrollTop();var _1375=oThis.getAbsoluteX();var _1376=oThis.getAbsoluteY();oThis.currentMouseX=diffX+_1373-_1375;oThis.currentMouseY=diffY+_1374-_1376;var obj=oThis.getBestFigure(oThis.currentMouseX,oThis.currentMouseY);if(draw2d.Drag.currentHover!==null&&obj===null){var _1378=new draw2d.DragDropEvent();_1378.initDragDropEvent("mouseleave",false,oThis);draw2d.Drag.currentHover.dispatchEvent(_1378);}else{var diffX=_1370.clientX;var diffY=_1370.clientY;var _1373=oThis.getScrollLeft();var _1374=oThis.getScrollTop();var _1375=oThis.getAbsoluteX();var _1376=oThis.getAbsoluteY();oThis.onMouseMove(diffX+_1373-_1375,diffY+_1374-_1376);}if(obj===null){draw2d.Drag.currentHover=null;}e.preventDefault();};var _1379=function(){var _137a=arguments[0]||window.event;var diffX=_137a.clientX;var diffY=_137a.clientY;var _137d=oThis.getScrollLeft();var _137e=oThis.getScrollTop();var _137f=oThis.getAbsoluteX();var _1380=oThis.getAbsoluteY();oThis.currentMouseX=diffX+_137d-_137f;oThis.currentMouseY=diffY+_137e-_1380;var obj=oThis.getBestFigure(oThis.currentMouseX,oThis.currentMouseY);if(draw2d.Drag.currentHover!==null&&obj===null){var _1382=new draw2d.DragDropEvent();_1382.initDragDropEvent("mouseleave",false,oThis);draw2d.Drag.currentHover.dispatchEvent(_1382);}else{var diffX=_137a.clientX;var diffY=_137a.clientY;var _137d=oThis.getScrollLeft();var _137e=oThis.getScrollTop();var _137f=oThis.getAbsoluteX();var _1380=oThis.getAbsoluteY();oThis.onMouseMove(diffX+_137d-_137f,diffY+_137e-_1380);}if(obj===null){draw2d.Drag.currentHover=null;}if(oThis.tooltip!==null){if(Math.abs(oThis.currentTooltipX-oThis.currentMouseX)>10||Math.abs(oThis.currentTooltipY-oThis.currentMouseY)>10){oThis.showTooltip(null);}}};var _1383=function(_1384){var _1384=arguments[0]||window.event;var diffX=_1384.clientX;var diffY=_1384.clientY;var _1387=oThis.getScrollLeft();var _1388=oThis.getScrollTop();var _1389=oThis.getAbsoluteX();var _138a=oThis.getAbsoluteY();var line=oThis.getBestLine(diffX+_1387-_1389,diffY+_1388-_138a,null);if(line!==null){line.onDoubleClick();}};if(this.html.addEventListener){this.html.addEventListener("contextmenu",_1348,false);this.html.addEventListener("touchstart",_135d,false);this.html.addEventListener("touchmove",_136e,false);this.html.addEventListener("mousemove",_1379,false);this.html.addEventListener("mouseup",_1366,false);this.html.addEventListener("mousedown",_1355,false);this.html.addEventListener("keydown",_1352,false);this.html.addEventListener("dblclick",_1383,false);}else{if(this.html.attachEvent){this.html.attachEvent("oncontextmenu",_1348);this.html.attachEvent("onmousemove",_1379);this.html.attachEvent("onmousedown",_1355);this.html.attachEvent("onmouseup",_1366);this.html.attachEvent("onkeydown",_1352);this.html.attachEvent("ondblclick",_1383);}else{throw "FreeGroup Draw2D 0.9.26 not supported in this browser.";}}}}catch(e){pushErrorStack(e,"draw2d.Workflow=function(/*:String*/id)");}};draw2d.Workflow.prototype=new draw2d.Canvas();draw2d.Workflow.prototype.type="draw2d.Workflow";draw2d.Workflow.COLOR_GREEN=new draw2d.Color(0,255,0);draw2d.Workflow.prototype.clear=function(){this.scrollTo(0,0,true);this.gridWidthX=10;this.gridWidthY=10;this.snapToGridHelper=null;this.verticalSnapToHelperLine=null;this.horizontalSnapToHelperLine=null;var _138c=this.getDocument();var _138d=_138c.getLines().clone();for(var i=0;i<_138d.getSize();i++){(new draw2d.CommandDelete(_138d.get(i))).execute();}var _138f=_138c.getFigures().clone();for(var i=0;i<_138f.getSize();i++){(new draw2d.CommandDelete(_138f.get(i))).execute();}this.commonPorts.removeAllElements();this.dropTargets.removeAllElements();this.compartments.removeAllElements();this.selectionListeners.removeAllElements();this.dialogs.removeAllElements();this.commandStack=new draw2d.CommandStack();this.currentSelection=null;this.currentMenu=null;draw2d.Drag.clearCurrent();};draw2d.Workflow.prototype.onScroll=function(){var _1390=this.getScrollLeft();var _1391=this.getScrollTop();var _1392=_1390-this.oldScrollPosLeft;var _1393=_1391-this.oldScrollPosTop;for(var i=0;i<this.figures.getSize();i++){var _1395=this.figures.get(i);if(_1395.hasFixedPosition&&_1395.hasFixedPosition()==true){_1395.setPosition(_1395.getX()+_1392,_1395.getY()+_1393);}}this.oldScrollPosLeft=_1390;this.oldScrollPosTop=_1391;};draw2d.Workflow.prototype.setPanning=function(flag){this.panning=flag;if(flag){this.html.style.cursor="move";}else{this.html.style.cursor="default";}};draw2d.Workflow.prototype.scrollTo=function(x,y,fast){if(fast){this.scrollArea.scrollLeft=x;this.scrollArea.scrollTop=y;}else{var steps=40;var xStep=(x-this.getScrollLeft())/steps;var yStep=(y-this.getScrollTop())/steps;var oldX=this.getScrollLeft();var oldY=this.getScrollTop();for(var i=0;i<steps;i++){this.scrollArea.scrollLeft=oldX+(xStep*i);this.scrollArea.scrollTop=oldY+(yStep*i);}}};draw2d.Workflow.prototype.showTooltip=function(_13a0,_13a1){if(this.tooltip!==null){this.removeFigure(this.tooltip);this.tooltip=null;if(this.tooltipTimer>=0){window.clearTimeout(this.tooltipTimer);this.tooltipTimer=-1;}}this.tooltip=_13a0;if(this.tooltip!==null){this.currentTooltipX=this.currentMouseX;this.currentTooltipY=this.currentMouseY;this.addFigure(this.tooltip,this.currentTooltipX+10,this.currentTooltipY+10);var oThis=this;var _13a3=function(){oThis.tooltipTimer=-1;oThis.showTooltip(null);};if(_13a1==true){this.tooltipTimer=window.setTimeout(_13a3,5000);}}};draw2d.Workflow.prototype.showDialog=function(_13a4,xPos,yPos){if(xPos){this.addFigure(_13a4,xPos,yPos);}else{this.addFigure(_13a4,200,100);}this.dialogs.add(_13a4);};draw2d.Workflow.prototype.showMenu=function(menu,xPos,yPos){if(this.menu!==null){this.html.removeChild(this.menu.getHTMLElement());this.menu.setWorkflow();}this.menu=menu;if(this.menu!==null){this.menu.setWorkflow(this);this.menu.setPosition(xPos,yPos);this.html.appendChild(this.menu.getHTMLElement());this.menu.paint();}};draw2d.Workflow.prototype.onContextMenu=function(x,y){var menu=this.getContextMenu();if(menu!==null){this.showMenu(menu,x,y);}};draw2d.Workflow.prototype.getContextMenu=function(){return null;};draw2d.Workflow.prototype.setToolWindow=function(_13ad,x,y){this.toolPalette=_13ad;if(y){this.addFigure(_13ad,x,y);}else{this.addFigure(_13ad,20,20);}this.dialogs.add(_13ad);};draw2d.Workflow.prototype.setSnapToGrid=function(flag){if(flag){this.snapToGridHelper=new draw2d.SnapToGrid(this);}else{this.snapToGridHelper=null;}};draw2d.Workflow.prototype.setSnapToGeometry=function(flag){if(flag){this.snapToGeometryHelper=new draw2d.SnapToGeometry(this);}else{this.snapToGeometryHelper=null;}};draw2d.Workflow.prototype.setGridWidth=function(dx,dy){this.gridWidthX=dx;this.gridWidthY=dy;};draw2d.Workflow.prototype.addFigure=function(_13b4,xPos,yPos){try{draw2d.Canvas.prototype.addFigure.call(this,_13b4,xPos,yPos,true);_13b4.setWorkflow(this);var _13b7=this;if(_13b4 instanceof draw2d.CompartmentFigure){this.compartments.add(_13b4);}if(_13b4 instanceof draw2d.Line){this.lines.add(_13b4);}else{this.figures.add(_13b4);_13b4.draggable.addEventListener("drag",function(_13b8){var _13b9=_13b7.getFigure(_13b8.target.element.id);if(_13b9===null){return;}if(_13b9.isSelectable()==false){return;}_13b7.moveResizeHandles(_13b9);});}_13b4.paint();this.setDocumentDirty();}catch(e){pushErrorStack(e,"draw2d.Workflow.prototype.addFigure=function(/*:draw2d.Figure*/ figure ,/*:int*/ xPos, /*:int*/ yPos)");}};draw2d.Workflow.prototype.removeFigure=function(_13ba){draw2d.Canvas.prototype.removeFigure.call(this,_13ba);this.figures.remove(_13ba);this.lines.remove(_13ba);this.dialogs.remove(_13ba);_13ba.setWorkflow(null);if(_13ba instanceof draw2d.CompartmentFigure){this.compartments.remove(_13ba);}if(_13ba instanceof draw2d.Connection){_13ba.disconnect();}if(this.currentSelection==_13ba){this.setCurrentSelection(null);}this.setDocumentDirty();_13ba.onRemove(this);};draw2d.Workflow.prototype.moveFront=function(_13bb){this.html.removeChild(_13bb.getHTMLElement());this.html.appendChild(_13bb.getHTMLElement());};draw2d.Workflow.prototype.moveBack=function(_13bc){this.html.removeChild(_13bc.getHTMLElement());this.html.insertBefore(_13bc.getHTMLElement(),this.html.firstChild);};draw2d.Workflow.prototype.getBestCompartmentFigure=function(x,y,_13bf){var _13c0=null;for(var i=0;i<this.figures.getSize();i++){var _13c2=this.figures.get(i);if((_13c2 instanceof draw2d.CompartmentFigure)&&_13c2.isOver(x,y)==true&&_13c2!=_13bf){if(_13c0===null){_13c0=_13c2;}else{if(_13c0.getZOrder()<_13c2.getZOrder()){_13c0=_13c2;}}}}return _13c0;};draw2d.Workflow.prototype.getBestFigure=function(x,y,_13c5){var _13c6=null;for(var i=0;i<this.figures.getSize();i++){var _13c8=this.figures.get(i);if(_13c8.isOver(x,y)==true&&_13c8!=_13c5){if(_13c6===null){_13c6=_13c8;}else{if(_13c6.getZOrder()<_13c8.getZOrder()){_13c6=_13c8;}}}}return _13c6;};draw2d.Workflow.prototype.getBestLine=function(x,y,_13cb){var _13cc=null;var count=this.lines.getSize();for(var i=0;i<count;i++){var line=this.lines.get(i);if(line.containsPoint(x,y)==true&&line!=_13cb){if(_13cc===null){_13cc=line;}else{if(_13cc.getZOrder()<line.getZOrder()){_13cc=line;}}}}return _13cc;};draw2d.Workflow.prototype.getFigure=function(id){for(var i=0;i<this.figures.getSize();i++){var _13d2=this.figures.get(i);if(_13d2.id==id){return _13d2;}}return null;};draw2d.Workflow.prototype.getFigures=function(){return this.figures;};draw2d.Workflow.prototype.getDocument=function(){return new draw2d.CanvasDocument(this);};draw2d.Workflow.prototype.addSelectionListener=function(w){if(w!==null){if(w.onSelectionChanged){this.selectionListeners.add(w);}else{throw "Object doesn't implement required callback method [onSelectionChanged]";}}};draw2d.Workflow.prototype.removeSelectionListener=function(w){this.selectionListeners.remove(w);};draw2d.Workflow.prototype.setCurrentSelection=function(_13d5){if(_13d5===null||this.currentSelection!=_13d5){this.hideResizeHandles();this.hideLineResizeHandles();}this.currentSelection=_13d5;for(var i=0;i<this.selectionListeners.getSize();i++){var w=this.selectionListeners.get(i);if(w.onSelectionChanged){w.onSelectionChanged(this.currentSelection,this.currentSelection?this.currentSelection.getModel():null);}}if(_13d5 instanceof draw2d.Line){this.showLineResizeHandles(_13d5);if(!(_13d5 instanceof draw2d.Connection)){this.draggingLineCommand=_13d5.createCommand(new draw2d.EditPolicy(draw2d.EditPolicy.MOVE));if(this.draggingLineCommand!==null){this.draggingLine=_13d5;}}}};draw2d.Workflow.prototype.getCurrentSelection=function(){return this.currentSelection;};draw2d.Workflow.prototype.getLine=function(id){var count=this.lines.getSize();for(var i=0;i<count;i++){var line=this.lines.get(i);if(line.getId()==id){return line;}}return null;};draw2d.Workflow.prototype.getLines=function(){return this.lines;};draw2d.Workflow.prototype.registerPort=function(port){port.draggable.targets=this.dropTargets;this.commonPorts.add(port);this.dropTargets.add(port.dropable);};draw2d.Workflow.prototype.unregisterPort=function(port){port.draggable.targets=null;this.commonPorts.remove(port);this.dropTargets.remove(port.dropable);};draw2d.Workflow.prototype.getCommandStack=function(){return this.commandStack;};draw2d.Workflow.prototype.showConnectionLine=function(x1,y1,x2,y2){this.connectionLine.setStartPoint(x1,y1);this.connectionLine.setEndPoint(x2,y2);if(this.connectionLine.canvas===null){draw2d.Canvas.prototype.addFigure.call(this,this.connectionLine);}};draw2d.Workflow.prototype.hideConnectionLine=function(){if(this.connectionLine.canvas!==null){draw2d.Canvas.prototype.removeFigure.call(this,this.connectionLine);}};draw2d.Workflow.prototype.showLineResizeHandles=function(_13e2){var _13e3=this.resizeHandleStart.getWidth()/2;var _13e4=this.resizeHandleStart.getHeight()/2;var _13e5=_13e2.getStartPoint();var _13e6=_13e2.getEndPoint();draw2d.Canvas.prototype.addFigure.call(this,this.resizeHandleStart,_13e5.x-_13e3,_13e5.y-_13e3);draw2d.Canvas.prototype.addFigure.call(this,this.resizeHandleEnd,_13e6.x-_13e3,_13e6.y-_13e3);this.resizeHandleStart.setCanDrag(_13e2.isResizeable());this.resizeHandleEnd.setCanDrag(_13e2.isResizeable());if(_13e2.isResizeable()){this.resizeHandleStart.setBackgroundColor(draw2d.Workflow.COLOR_GREEN);this.resizeHandleEnd.setBackgroundColor(draw2d.Workflow.COLOR_GREEN);this.resizeHandleStart.draggable.targets=this.dropTargets;this.resizeHandleEnd.draggable.targets=this.dropTargets;}else{this.resizeHandleStart.setBackgroundColor(null);this.resizeHandleEnd.setBackgroundColor(null);}};draw2d.Workflow.prototype.hideLineResizeHandles=function(){if(this.resizeHandleStart.canvas!==null){draw2d.Canvas.prototype.removeFigure.call(this,this.resizeHandleStart);}if(this.resizeHandleEnd.canvas!==null){draw2d.Canvas.prototype.removeFigure.call(this,this.resizeHandleEnd);}};draw2d.Workflow.prototype.showResizeHandles=function(_13e7){this.hideLineResizeHandles();this.hideResizeHandles();if(this.getEnableSmoothFigureHandling()==true&&this.getCurrentSelection()!=_13e7){this.resizeHandle1.setAlpha(0.01);this.resizeHandle2.setAlpha(0.01);this.resizeHandle3.setAlpha(0.01);this.resizeHandle4.setAlpha(0.01);this.resizeHandle5.setAlpha(0.01);this.resizeHandle6.setAlpha(0.01);this.resizeHandle7.setAlpha(0.01);this.resizeHandle8.setAlpha(0.01);}var _13e8=this.resizeHandle1.getWidth();var _13e9=this.resizeHandle1.getHeight();var _13ea=_13e7.getHeight();var _13eb=_13e7.getWidth();var xPos=_13e7.getX();var yPos=_13e7.getY();draw2d.Canvas.prototype.addFigure.call(this,this.resizeHandle1,xPos-_13e8,yPos-_13e9);draw2d.Canvas.prototype.addFigure.call(this,this.resizeHandle3,xPos+_13eb,yPos-_13e9);draw2d.Canvas.prototype.addFigure.call(this,this.resizeHandle5,xPos+_13eb,yPos+_13ea);draw2d.Canvas.prototype.addFigure.call(this,this.resizeHandle7,xPos-_13e8,yPos+_13ea);this.moveFront(this.resizeHandle1);this.moveFront(this.resizeHandle3);this.moveFront(this.resizeHandle5);this.moveFront(this.resizeHandle7);this.resizeHandle1.setCanDrag(_13e7.isResizeable());this.resizeHandle3.setCanDrag(_13e7.isResizeable());this.resizeHandle5.setCanDrag(_13e7.isResizeable());this.resizeHandle7.setCanDrag(_13e7.isResizeable());if(_13e7.isResizeable()){var green=new draw2d.Color(0,255,0);this.resizeHandle1.setBackgroundColor(green);this.resizeHandle3.setBackgroundColor(green);this.resizeHandle5.setBackgroundColor(green);this.resizeHandle7.setBackgroundColor(green);}else{this.resizeHandle1.setBackgroundColor(null);this.resizeHandle3.setBackgroundColor(null);this.resizeHandle5.setBackgroundColor(null);this.resizeHandle7.setBackgroundColor(null);}if(_13e7.isStrechable()&&_13e7.isResizeable()){this.resizeHandle2.setCanDrag(_13e7.isResizeable());this.resizeHandle4.setCanDrag(_13e7.isResizeable());this.resizeHandle6.setCanDrag(_13e7.isResizeable());this.resizeHandle8.setCanDrag(_13e7.isResizeable());draw2d.Canvas.prototype.addFigure.call(this,this.resizeHandle2,xPos+(_13eb/2)-this.resizeHandleHalfWidth,yPos-_13e9);draw2d.Canvas.prototype.addFigure.call(this,this.resizeHandle4,xPos+_13eb,yPos+(_13ea/2)-(_13e9/2));draw2d.Canvas.prototype.addFigure.call(this,this.resizeHandle6,xPos+(_13eb/2)-this.resizeHandleHalfWidth,yPos+_13ea);draw2d.Canvas.prototype.addFigure.call(this,this.resizeHandle8,xPos-_13e8,yPos+(_13ea/2)-(_13e9/2));this.moveFront(this.resizeHandle2);this.moveFront(this.resizeHandle4);this.moveFront(this.resizeHandle6);this.moveFront(this.resizeHandle8);}};draw2d.Workflow.prototype.hideResizeHandles=function(){if(this.resizeHandle1.canvas!==null){draw2d.Canvas.prototype.removeFigure.call(this,this.resizeHandle1);}if(this.resizeHandle2.canvas!==null){draw2d.Canvas.prototype.removeFigure.call(this,this.resizeHandle2);}if(this.resizeHandle3.canvas!==null){draw2d.Canvas.prototype.removeFigure.call(this,this.resizeHandle3);}if(this.resizeHandle4.canvas!==null){draw2d.Canvas.prototype.removeFigure.call(this,this.resizeHandle4);}if(this.resizeHandle5.canvas!==null){draw2d.Canvas.prototype.removeFigure.call(this,this.resizeHandle5);}if(this.resizeHandle6.canvas!==null){draw2d.Canvas.prototype.removeFigure.call(this,this.resizeHandle6);}if(this.resizeHandle7.canvas!==null){draw2d.Canvas.prototype.removeFigure.call(this,this.resizeHandle7);}if(this.resizeHandle8.canvas!==null){draw2d.Canvas.prototype.removeFigure.call(this,this.resizeHandle8);}};draw2d.Workflow.prototype.moveResizeHandles=function(_13ef){var _13f0=this.resizeHandle1.getWidth();var _13f1=this.resizeHandle1.getHeight();var _13f2=_13ef.getHeight();var _13f3=_13ef.getWidth();var xPos=_13ef.getX();var yPos=_13ef.getY();this.resizeHandle1.setPosition(xPos-_13f0,yPos-_13f1);this.resizeHandle3.setPosition(xPos+_13f3,yPos-_13f1);this.resizeHandle5.setPosition(xPos+_13f3,yPos+_13f2);this.resizeHandle7.setPosition(xPos-_13f0,yPos+_13f2);if(_13ef.isStrechable()){this.resizeHandle2.setPosition(xPos+(_13f3/2)-this.resizeHandleHalfWidth,yPos-_13f1);this.resizeHandle4.setPosition(xPos+_13f3,yPos+(_13f2/2)-(_13f1/2));this.resizeHandle6.setPosition(xPos+(_13f3/2)-this.resizeHandleHalfWidth,yPos+_13f2);this.resizeHandle8.setPosition(xPos-_13f0,yPos+(_13f2/2)-(_13f1/2));}};draw2d.Workflow.prototype.onMouseDown=function(x,y){this.dragging=true;this.mouseDownPosX=x;this.mouseDownPosY=y;if(this.toolPalette!==null&&this.toolPalette.getActiveTool()!==null){this.toolPalette.getActiveTool().execute(x,y);}this.showMenu(null);var line=this.getBestLine(x,y);if(line!==null&&line.isSelectable()){this.setCurrentSelection(line);}else{this.setCurrentSelection(null);}};draw2d.Workflow.prototype.onMouseUp=function(x,y){this.dragging=false;if(this.draggingLineCommand!==null){this.getCommandStack().execute(this.draggingLineCommand);this.draggingLine=null;this.draggingLineCommand=null;}};draw2d.Workflow.prototype.onMouseMove=function(x,y){if(this.dragging===true&&this.draggingLine!==null){var diffX=x-this.mouseDownPosX;var diffY=y-this.mouseDownPosY;this.draggingLine.startX=this.draggingLine.getStartX()+diffX;this.draggingLine.startY=this.draggingLine.getStartY()+diffY;this.draggingLine.setEndPoint(this.draggingLine.getEndX()+diffX,this.draggingLine.getEndY()+diffY);this.mouseDownPosX=x;this.mouseDownPosY=y;this.showLineResizeHandles(this.currentSelection);}else{if(this.dragging===true&&this.panning===true){var diffX=x-this.mouseDownPosX;var diffY=y-this.mouseDownPosY;this.scrollTo(this.getScrollLeft()-diffX,this.getScrollTop()-diffY,true);this.onScroll();}}};draw2d.Workflow.prototype.onKeyDown=function(_13ff,ctrl){if(_13ff==46&&this.currentSelection!==null){this.commandStack.execute(this.currentSelection.createCommand(new draw2d.EditPolicy(draw2d.EditPolicy.DELETE)));}else{if(_13ff==90&&ctrl){this.commandStack.undo();}else{if(_13ff==89&&ctrl){this.commandStack.redo();}}}};draw2d.Workflow.prototype.setDocumentDirty=function(){try{for(var i=0;i<this.dialogs.getSize();i++){var d=this.dialogs.get(i);if(d!==null&&d.onSetDocumentDirty){d.onSetDocumentDirty();}}if(this.snapToGeometryHelper!==null){this.snapToGeometryHelper.onSetDocumentDirty();}if(this.snapToGridHelper!==null){this.snapToGridHelper.onSetDocumentDirty();}}catch(e){pushErrorStack(e,"draw2d.Workflow.prototype.setDocumentDirty=function()");}};draw2d.Workflow.prototype.snapToHelper=function(_1403,pos){if(this.snapToGeometryHelper!==null){if(_1403 instanceof draw2d.ResizeHandle){var _1405=_1403.getSnapToGridAnchor();pos.x+=_1405.x;pos.y+=_1405.y;var _1406=new draw2d.Point(pos.x,pos.y);var _1407=_1403.getSnapToDirection();var _1408=this.snapToGeometryHelper.snapPoint(_1407,pos,_1406);if((_1407&draw2d.SnapToHelper.EAST_WEST)&&!(_1408&draw2d.SnapToHelper.EAST_WEST)){this.showSnapToHelperLineVertical(_1406.x);}else{this.hideSnapToHelperLineVertical();}if((_1407&draw2d.SnapToHelper.NORTH_SOUTH)&&!(_1408&draw2d.SnapToHelper.NORTH_SOUTH)){this.showSnapToHelperLineHorizontal(_1406.y);}else{this.hideSnapToHelperLineHorizontal();}_1406.x-=_1405.x;_1406.y-=_1405.y;return _1406;}else{var _1409=new draw2d.Dimension(pos.x,pos.y,_1403.getWidth(),_1403.getHeight());var _1406=new draw2d.Dimension(pos.x,pos.y,_1403.getWidth(),_1403.getHeight());var _1407=draw2d.SnapToHelper.NSEW;var _1408=this.snapToGeometryHelper.snapRectangle(_1409,_1406);if((_1407&draw2d.SnapToHelper.WEST)&&!(_1408&draw2d.SnapToHelper.WEST)){this.showSnapToHelperLineVertical(_1406.x);}else{if((_1407&draw2d.SnapToHelper.EAST)&&!(_1408&draw2d.SnapToHelper.EAST)){this.showSnapToHelperLineVertical(_1406.getX()+_1406.getWidth());}else{this.hideSnapToHelperLineVertical();}}if((_1407&draw2d.SnapToHelper.NORTH)&&!(_1408&draw2d.SnapToHelper.NORTH)){this.showSnapToHelperLineHorizontal(_1406.y);}else{if((_1407&draw2d.SnapToHelper.SOUTH)&&!(_1408&draw2d.SnapToHelper.SOUTH)){this.showSnapToHelperLineHorizontal(_1406.getY()+_1406.getHeight());}else{this.hideSnapToHelperLineHorizontal();}}return _1406.getTopLeft();}}else{if(this.snapToGridHelper!==null){var _1405=_1403.getSnapToGridAnchor();pos.x=pos.x+_1405.x;pos.y=pos.y+_1405.y;var _1406=new draw2d.Point(pos.x,pos.y);this.snapToGridHelper.snapPoint(0,pos,_1406);_1406.x=_1406.x-_1405.x;_1406.y=_1406.y-_1405.y;return _1406;}}return pos;};draw2d.Workflow.prototype.showSnapToHelperLineHorizontal=function(_140a){if(this.horizontalSnapToHelperLine===null){this.horizontalSnapToHelperLine=new draw2d.Line();this.horizontalSnapToHelperLine.setColor(new draw2d.Color(175,175,255));this.addFigure(this.horizontalSnapToHelperLine);}this.horizontalSnapToHelperLine.setStartPoint(0,_140a);this.horizontalSnapToHelperLine.setEndPoint(this.getWidth(),_140a);};draw2d.Workflow.prototype.showSnapToHelperLineVertical=function(_140b){if(this.verticalSnapToHelperLine===null){this.verticalSnapToHelperLine=new draw2d.Line();this.verticalSnapToHelperLine.setColor(new draw2d.Color(175,175,255));this.addFigure(this.verticalSnapToHelperLine);}this.verticalSnapToHelperLine.setStartPoint(_140b,0);this.verticalSnapToHelperLine.setEndPoint(_140b,this.getHeight());};draw2d.Workflow.prototype.hideSnapToHelperLines=function(){this.hideSnapToHelperLineHorizontal();this.hideSnapToHelperLineVertical();};draw2d.Workflow.prototype.hideSnapToHelperLineHorizontal=function(){if(this.horizontalSnapToHelperLine!==null){this.removeFigure(this.horizontalSnapToHelperLine);this.horizontalSnapToHelperLine=null;}};draw2d.Workflow.prototype.hideSnapToHelperLineVertical=function(){if(this.verticalSnapToHelperLine!==null){this.removeFigure(this.verticalSnapToHelperLine);this.verticalSnapToHelperLine=null;}};