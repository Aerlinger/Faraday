/**
This notice must be untouched at all times.
This is the COMPRESSED version of Draw2D
WebSite: http://www.draw2d.org
Copyright: 2006 Andreas Herz. All rights reserved.
Created: 5.11.2006 by Andreas Herz (Web: http://www.freegroup.de )
LICENSE: LGPL
**/

draw2d.SnapToGeometry=function(_121c){draw2d.SnapToHelper.call(this,_121c);this.rows=null;this.cols=null;};draw2d.SnapToGeometry.prototype=new draw2d.SnapToHelper();draw2d.SnapToGeometry.THRESHOLD=5;draw2d.SnapToGeometry.prototype.snapPoint=function(_121d,_121e,_121f){if(this.rows===null||this.cols===null){this.populateRowsAndCols();}if((_121d&draw2d.SnapToHelper.EAST)!==0){var _1220=this.getCorrectionFor(this.cols,_121e.getX()-1,1);if(_1220!==draw2d.SnapToGeometry.THRESHOLD){_121d&=~draw2d.SnapToHelper.EAST;_121f.x+=_1220;}}if((_121d&draw2d.SnapToHelper.WEST)!==0){var _1221=this.getCorrectionFor(this.cols,_121e.getX(),-1);if(_1221!==draw2d.SnapToGeometry.THRESHOLD){_121d&=~draw2d.SnapToHelper.WEST;_121f.x+=_1221;}}if((_121d&draw2d.SnapToHelper.SOUTH)!==0){var _1222=this.getCorrectionFor(this.rows,_121e.getY()-1,1);if(_1222!==draw2d.SnapToGeometry.THRESHOLD){_121d&=~draw2d.SnapToHelper.SOUTH;_121f.y+=_1222;}}if((_121d&draw2d.SnapToHelper.NORTH)!==0){var _1223=this.getCorrectionFor(this.rows,_121e.getY(),-1);if(_1223!==draw2d.SnapToGeometry.THRESHOLD){_121d&=~draw2d.SnapToHelper.NORTH;_121f.y+=_1223;}}return _121d;};draw2d.SnapToGeometry.prototype.snapRectangle=function(_1224,_1225){var _1226=_1224.getTopLeft();var _1227=_1224.getBottomRight();var _1228=this.snapPoint(draw2d.SnapToHelper.NORTH_WEST,_1224.getTopLeft(),_1226);_1225.x=_1226.x;_1225.y=_1226.y;var _1229=this.snapPoint(draw2d.SnapToHelper.SOUTH_EAST,_1224.getBottomRight(),_1227);if(_1228&draw2d.SnapToHelper.WEST){_1225.x=_1227.x-_1224.getWidth();}if(_1228&draw2d.SnapToHelper.NORTH){_1225.y=_1227.y-_1224.getHeight();}return _1228|_1229;};draw2d.SnapToGeometry.prototype.populateRowsAndCols=function(){this.rows=[];this.cols=[];var _122a=this.workflow.getDocument().getFigures();var index=0;for(var i=0;i<_122a.getSize();i++){var _122d=_122a.get(i);if(_122d!=this.workflow.getCurrentSelection()){var _122e=_122d.getBounds();this.cols[index*3]=new draw2d.SnapToGeometryEntry(-1,_122e.getX());this.rows[index*3]=new draw2d.SnapToGeometryEntry(-1,_122e.getY());this.cols[index*3+1]=new draw2d.SnapToGeometryEntry(0,_122e.x+(_122e.getWidth()-1)/2);this.rows[index*3+1]=new draw2d.SnapToGeometryEntry(0,_122e.y+(_122e.getHeight()-1)/2);this.cols[index*3+2]=new draw2d.SnapToGeometryEntry(1,_122e.getRight()-1);this.rows[index*3+2]=new draw2d.SnapToGeometryEntry(1,_122e.getBottom()-1);index++;}}};draw2d.SnapToGeometry.prototype.getCorrectionFor=function(_122f,value,side){var _1232=draw2d.SnapToGeometry.THRESHOLD;var _1233=draw2d.SnapToGeometry.THRESHOLD;for(var i=0;i<_122f.length;i++){var entry=_122f[i];var _1236;if(entry.type===-1&&side!==0){_1236=Math.abs(value-entry.location);if(_1236<_1232){_1232=_1236;_1233=entry.location-value;}}else{if(entry.type===0&&side===0){_1236=Math.abs(value-entry.location);if(_1236<_1232){_1232=_1236;_1233=entry.location-value;}}else{if(entry.type===1&&side!==0){_1236=Math.abs(value-entry.location);if(_1236<_1232){_1232=_1236;_1233=entry.location-value;}}}}}return _1233;};draw2d.SnapToGeometry.prototype.onSetDocumentDirty=function(){this.rows=null;this.cols=null;};