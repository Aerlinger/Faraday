/**
This notice must be untouched at all times.
This is the COMPRESSED version of Draw2D
WebSite: http://www.draw2d.org
Copyright: 2006 Andreas Herz. All rights reserved.
Created: 5.11.2006 by Andreas Herz (Web: http://www.freegroup.de )
LICENSE: LGPL
**/

draw2d.BezierConnectionRouter=function(_1307){if(!_1307){this.cheapRouter=new draw2d.ManhattanConnectionRouter();}else{this.cheapRouter=null;}this.iteration=5;};draw2d.BezierConnectionRouter.prototype=new draw2d.ConnectionRouter();draw2d.BezierConnectionRouter.prototype.type="draw2d.BezierConnectionRouter";draw2d.BezierConnectionRouter.prototype.drawBezier=function(_1308,_1309,t,iter){var n=_1308.length-1;var q=[];var _130e=n+1;for(var i=0;i<_130e;i++){q[i]=[];q[i][0]=_1308[i];}for(var j=1;j<=n;j++){for(var i=0;i<=(n-j);i++){q[i][j]=new draw2d.Point((1-t)*q[i][j-1].x+t*q[i+1][j-1].x,(1-t)*q[i][j-1].y+t*q[i+1][j-1].y);}}var c1=[];var c2=[];for(var i=0;i<n+1;i++){c1[i]=q[0][i];c2[i]=q[i][n-i];}if(iter>=0){this.drawBezier(c1,_1309,t,--iter);this.drawBezier(c2,_1309,t,--iter);}else{for(var i=0;i<n;i++){_1309.push(q[i][n-i]);}}};draw2d.BezierConnectionRouter.prototype.route=function(conn){if(this.cheapRouter!==null&&(conn.getSource().getParent().isMoving===true||conn.getTarget().getParent().isMoving===true)){this.cheapRouter.route(conn);return;}var _1314=[];var _1315=conn.getStartPoint();var toPt=conn.getEndPoint();this._route(_1314,conn,toPt,this.getEndDirection(conn),_1315,this.getStartDirection(conn));var _1317=[];this.drawBezier(_1314,_1317,0.5,this.iteration);for(var i=0;i<_1317.length;i++){conn.addPoint(_1317[i]);}conn.addPoint(toPt);};draw2d.BezierConnectionRouter.prototype._route=function(_1319,conn,_131b,_131c,toPt,toDir){var TOL=0.1;var _1320=0.01;var _1321=90;var UP=0;var RIGHT=1;var DOWN=2;var LEFT=3;var xDiff=_131b.x-toPt.x;var yDiff=_131b.y-toPt.y;var point;var dir;if(((xDiff*xDiff)<(_1320))&&((yDiff*yDiff)<(_1320))){_1319.push(new draw2d.Point(toPt.x,toPt.y));return;}if(_131c===LEFT){if((xDiff>0)&&((yDiff*yDiff)<TOL)&&(toDir===RIGHT)){point=toPt;dir=toDir;}else{if(xDiff<0){point=new draw2d.Point(_131b.x-_1321,_131b.y);}else{if(((yDiff>0)&&(toDir===DOWN))||((yDiff<0)&&(toDir===UP))){point=new draw2d.Point(toPt.x,_131b.y);}else{if(_131c===toDir){var pos=Math.min(_131b.x,toPt.x)-_1321;point=new draw2d.Point(pos,_131b.y);}else{point=new draw2d.Point(_131b.x-(xDiff/2),_131b.y);}}}if(yDiff>0){dir=UP;}else{dir=DOWN;}}}else{if(_131c===RIGHT){if((xDiff<0)&&((yDiff*yDiff)<TOL)&&(toDir==LEFT)){point=toPt;dir=toDir;}else{if(xDiff>0){point=new draw2d.Point(_131b.x+_1321,_131b.y);}else{if(((yDiff>0)&&(toDir===DOWN))||((yDiff<0)&&(toDir===UP))){point=new draw2d.Point(toPt.x,_131b.y);}else{if(_131c===toDir){var pos=Math.max(_131b.x,toPt.x)+_1321;point=new draw2d.Point(pos,_131b.y);}else{point=new draw2d.Point(_131b.x-(xDiff/2),_131b.y);}}}if(yDiff>0){dir=UP;}else{dir=DOWN;}}}else{if(_131c===DOWN){if(((xDiff*xDiff)<TOL)&&(yDiff<0)&&(toDir===UP)){point=toPt;dir=toDir;}else{if(yDiff>0){point=new draw2d.Point(_131b.x,_131b.y+_1321);}else{if(((xDiff>0)&&(toDir===RIGHT))||((xDiff<0)&&(toDir===LEFT))){point=new draw2d.Point(_131b.x,toPt.y);}else{if(_131c===toDir){var pos=Math.max(_131b.y,toPt.y)+_1321;point=new draw2d.Point(_131b.x,pos);}else{point=new draw2d.Point(_131b.x,_131b.y-(yDiff/2));}}}if(xDiff>0){dir=LEFT;}else{dir=RIGHT;}}}else{if(_131c===UP){if(((xDiff*xDiff)<TOL)&&(yDiff>0)&&(toDir===DOWN)){point=toPt;dir=toDir;}else{if(yDiff<0){point=new draw2d.Point(_131b.x,_131b.y-_1321);}else{if(((xDiff>0)&&(toDir===RIGHT))||((xDiff<0)&&(toDir===LEFT))){point=new draw2d.Point(_131b.x,toPt.y);}else{if(_131c===toDir){var pos=Math.min(_131b.y,toPt.y)-_1321;point=new draw2d.Point(_131b.x,pos);}else{point=new draw2d.Point(_131b.x,_131b.y-(yDiff/2));}}}if(xDiff>0){dir=LEFT;}else{dir=RIGHT;}}}}}}this._route(_1319,conn,point,dir,toPt,toDir);_1319.push(_131b);};