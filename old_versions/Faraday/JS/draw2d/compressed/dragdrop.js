/**
This notice must be untouched at all times.
This is the COMPRESSED version of Draw2D
WebSite: http://www.draw2d.org
Copyright: 2006 Andreas Herz. All rights reserved.
Created: 5.11.2006 by Andreas Herz (Web: http://www.freegroup.de )
LICENSE: LGPL
**/

draw2d.Drag=function(){};draw2d.Drag.current=null;draw2d.Drag.currentTarget=null;draw2d.Drag.currentHover=null;draw2d.Drag.currentCompartment=null;draw2d.Drag.dragging=false;draw2d.Drag.isDragging=function(){return this.dragging;};draw2d.Drag.setCurrent=function(_1bfb){this.current=_1bfb;this.dragging=true;};draw2d.Drag.getCurrent=function(){return this.current;};draw2d.Drag.clearCurrent=function(){this.current=null;this.dragging=false;this.currentTarget=null;};draw2d.Draggable=function(_1bfc,_1bfd){this.id=draw2d.UUID.create();this.node=null;draw2d.EventTarget.call(this);this.construct(_1bfc,_1bfd);this.diffX=0;this.diffY=0;this.targets=new draw2d.ArrayList();};draw2d.Draggable.prototype=new draw2d.EventTarget();draw2d.Draggable.prototype.construct=function(_1bfe){if(_1bfe===null||_1bfe===undefined){return;}this.element=_1bfe;var oThis=this;var _1c00=function(){var _1c01=new draw2d.DragDropEvent();_1c01.initDragDropEvent("dblclick",true);oThis.dispatchEvent(_1c01);var _1c02=arguments[0]||window.event;_1c02.cancelBubble=true;_1c02.returnValue=false;};var _1c03=function(){var _1c04=arguments[0]||window.event;var _1c05=new draw2d.DragDropEvent();if(oThis.node!==null){var _1c06=oThis.node.getWorkflow().getAbsoluteX();var _1c07=oThis.node.getWorkflow().getAbsoluteY();var _1c08=oThis.node.getWorkflow().getScrollLeft();var _1c09=oThis.node.getWorkflow().getScrollTop();_1c05.x=_1c04.clientX-oThis.element.offsetLeft+_1c08-_1c06;_1c05.y=_1c04.clientY-oThis.element.offsetTop+_1c09-_1c07;}if(_1c04.button===2){_1c05.initDragDropEvent("contextmenu",true);oThis.dispatchEvent(_1c05);}else{_1c05.initDragDropEvent("dragstart",true);if(oThis.dispatchEvent(_1c05)){oThis.diffX=_1c04.clientX-oThis.element.offsetLeft;oThis.diffY=_1c04.clientY-oThis.element.offsetTop;draw2d.Drag.setCurrent(oThis);if(oThis.isAttached==true){oThis.detachEventHandlers();}oThis.attachEventHandlers();}}_1c04.cancelBubble=true;_1c04.returnValue=false;};var _1c0a=function(){if(draw2d.Drag.getCurrent()===null){var _1c0b=arguments[0]||window.event;if(draw2d.Drag.currentHover!==null&&oThis!==draw2d.Drag.currentHover){var _1c0c=new draw2d.DragDropEvent();_1c0c.initDragDropEvent("mouseleave",false,oThis);draw2d.Drag.currentHover.dispatchEvent(_1c0c);}if(oThis!==null&&oThis!==draw2d.Drag.currentHover){var _1c0c=new draw2d.DragDropEvent();_1c0c.initDragDropEvent("mouseenter",false,oThis);oThis.dispatchEvent(_1c0c);}draw2d.Drag.currentHover=oThis;}else{}};if(this.element.addEventListener){this.element.addEventListener("mousemove",_1c0a,false);this.element.addEventListener("mousedown",_1c03,false);this.element.addEventListener("dblclick",_1c00,false);}else{if(this.element.attachEvent){this.element.attachEvent("onmousemove",_1c0a);this.element.attachEvent("onmousedown",_1c03);this.element.attachEvent("ondblclick",_1c00);}else{throw "Drag not supported in this browser.";}}};draw2d.Draggable.prototype.onDrop=function(_1c0d,_1c0e){};draw2d.Draggable.prototype.attachEventHandlers=function(){var oThis=this;oThis.isAttached=true;this.tempMouseMove=function(){var _1c10=arguments[0]||window.event;var _1c11=new draw2d.Point(_1c10.clientX-oThis.diffX,_1c10.clientY-oThis.diffY);if(oThis.node!==null&&oThis.node.getCanSnapToHelper()){_1c11=oThis.node.getWorkflow().snapToHelper(oThis.node,_1c11);}oThis.element.style.left=_1c11.x+"px";oThis.element.style.top=_1c11.y+"px";if(oThis.node!==null){var _1c12=oThis.node.getWorkflow().getScrollLeft();var _1c13=oThis.node.getWorkflow().getScrollTop();var _1c14=oThis.node.getWorkflow().getAbsoluteX();var _1c15=oThis.node.getWorkflow().getAbsoluteY();var _1c16=oThis.getDropTarget(_1c10.clientX+_1c12-_1c14,_1c10.clientY+_1c13-_1c15);var _1c17=oThis.getCompartment(_1c10.clientX+_1c12-_1c14,_1c10.clientY+_1c13-_1c15);if(draw2d.Drag.currentTarget!==null&&_1c16!=draw2d.Drag.currentTarget){var _1c18=new draw2d.DragDropEvent();_1c18.initDragDropEvent("dragleave",false,oThis);draw2d.Drag.currentTarget.dispatchEvent(_1c18);}if(_1c16!==null&&_1c16!==draw2d.Drag.currentTarget){var _1c18=new draw2d.DragDropEvent();_1c18.initDragDropEvent("dragenter",false,oThis);_1c16.dispatchEvent(_1c18);}draw2d.Drag.currentTarget=_1c16;if(draw2d.Drag.currentCompartment!==null&&_1c17!==draw2d.Drag.currentCompartment){var _1c18=new draw2d.DragDropEvent();_1c18.initDragDropEvent("figureleave",false,oThis);draw2d.Drag.currentCompartment.dispatchEvent(_1c18);}if(_1c17!==null&&_1c17.node!=oThis.node&&_1c17!==draw2d.Drag.currentCompartment){var _1c18=new draw2d.DragDropEvent();_1c18.initDragDropEvent("figureenter",false,oThis);_1c17.dispatchEvent(_1c18);}draw2d.Drag.currentCompartment=_1c17;}var _1c19=new draw2d.DragDropEvent();_1c19.initDragDropEvent("drag",false);oThis.dispatchEvent(_1c19);};oThis.tempMouseUp=function(){oThis.detachEventHandlers();var _1c1a=arguments[0]||window.event;if(oThis.node!==null){var _1c1b=oThis.node.getWorkflow().getScrollLeft();var _1c1c=oThis.node.getWorkflow().getScrollTop();var _1c1d=oThis.node.getWorkflow().getAbsoluteX();var _1c1e=oThis.node.getWorkflow().getAbsoluteY();var _1c1f=oThis.getDropTarget(_1c1a.clientX+_1c1b-_1c1d,_1c1a.clientY+_1c1c-_1c1e);var _1c20=oThis.getCompartment(_1c1a.clientX+_1c1b-_1c1d,_1c1a.clientY+_1c1c-_1c1e);if(_1c1f!==null){var _1c21=new draw2d.DragDropEvent();_1c21.initDragDropEvent("drop",false,oThis);_1c1f.dispatchEvent(_1c21);}if(_1c20!==null&&_1c20.node!==oThis.node){var _1c21=new draw2d.DragDropEvent();_1c21.initDragDropEvent("figuredrop",false,oThis);_1c20.dispatchEvent(_1c21);}if(draw2d.Drag.currentTarget!==null){var _1c21=new draw2d.DragDropEvent();_1c21.initDragDropEvent("dragleave",false,oThis);draw2d.Drag.currentTarget.dispatchEvent(_1c21);draw2d.Drag.currentTarget=null;}}var _1c22=new draw2d.DragDropEvent();_1c22.initDragDropEvent("dragend",false);oThis.dispatchEvent(_1c22);oThis.onDrop(_1c1a.clientX,_1c1a.clientY);draw2d.Drag.currentCompartment=null;draw2d.Drag.clearCurrent();};if(document.body.addEventListener){document.body.addEventListener("mousemove",this.tempMouseMove,false);document.body.addEventListener("mouseup",this.tempMouseUp,false);}else{if(document.body.attachEvent){document.body.attachEvent("onmousemove",this.tempMouseMove);document.body.attachEvent("onmouseup",this.tempMouseUp);}else{throw new Error("Drag doesn't support this browser.");}}};draw2d.Draggable.prototype.detachEventHandlers=function(){this.isAttached=false;if(document.body.removeEventListener){document.body.removeEventListener("mousemove",this.tempMouseMove,false);document.body.removeEventListener("mouseup",this.tempMouseUp,false);}else{if(document.body.detachEvent){document.body.detachEvent("onmousemove",this.tempMouseMove);document.body.detachEvent("onmouseup",this.tempMouseUp);}else{throw new Error("Drag doesn't support this browser.");}}};draw2d.Draggable.prototype.getDropTarget=function(x,y){for(var i=0;i<this.targets.getSize();i++){var _1c26=this.targets.get(i);if(_1c26.node.isOver(x,y)&&_1c26.node!==this.node){return _1c26;}}return null;};draw2d.Draggable.prototype.getCompartment=function(x,y){var _1c29=null;for(var i=0;i<this.node.getWorkflow().compartments.getSize();i++){var _1c2b=this.node.getWorkflow().compartments.get(i);if(_1c2b.isOver(x,y)&&_1c2b!==this.node){if(_1c29===null){_1c29=_1c2b;}else{if(_1c29.getZOrder()<_1c2b.getZOrder()){_1c29=_1c2b;}}}}return _1c29===null?null:_1c29.dropable;};draw2d.Draggable.prototype.getLeft=function(){return this.element.offsetLeft;};draw2d.Draggable.prototype.getTop=function(){return this.element.offsetTop;};draw2d.DragDropEvent=function(){draw2d.AbstractEvent.call(this);};draw2d.DragDropEvent.prototype=new draw2d.AbstractEvent();draw2d.DragDropEvent.prototype.initDragDropEvent=function(sType,_1c2d,_1c2e){this.initEvent(sType,_1c2d);this.relatedTarget=_1c2e;};draw2d.DropTarget=function(_1c2f){draw2d.EventTarget.call(this);this.construct(_1c2f);};draw2d.DropTarget.prototype=new draw2d.EventTarget();draw2d.DropTarget.prototype.construct=function(_1c30){this.element=_1c30;};draw2d.DropTarget.prototype.getLeft=function(){var el=this.element;var ol=el.offsetLeft;while((el=el.offsetParent)!==null){ol+=el.offsetLeft;}return ol;};draw2d.DropTarget.prototype.getTop=function(){var el=this.element;var ot=el.offsetTop;while((el=el.offsetParent)!==null){ot+=el.offsetTop;}return ot;};draw2d.DropTarget.prototype.getHeight=function(){return this.element.offsetHeight;};draw2d.DropTarget.prototype.getWidth=function(){return this.element.offsetWidth;};